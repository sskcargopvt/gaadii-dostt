<!-- 
  Real-Time Booking Requests UI for Driver Dashboard
  Add this to your driver-dashboard.component.html
-->

<!-- Connection Status Indicator -->
<div class="realtime-status">
    @if (isConnected()) {
    <div class="status-badge connected">
        <span class="pulse-dot"></span>
        <span class="status-text">Live Feed Active</span>
        <span class="booking-count">{{ liveBookings().length }} requests</span>
    </div>
    } @else {
    <div class="status-badge disconnected">
        <span class="status-text">Disconnected</span>
    </div>
    }
</div>

<!-- Booking Requests Section -->
<section class="booking-requests-section">
    <div class="section-header">
        <h2>üì± Incoming Booking Requests</h2>
        <p class="subtitle">Real-time updates from customers</p>
    </div>

    <!-- Empty State -->
    @if (liveBookings().length === 0) {
    <div class="empty-state">
        <div class="empty-icon">üöõ</div>
        <h3>No booking requests yet</h3>
        <p>Waiting for customers to send booking requests...</p>
        <p class="hint">You'll be notified instantly when a new request arrives!</p>
    </div>
    }

    <!-- Booking Cards -->
    @else {
    <div class="bookings-grid">
        @for (booking of liveBookings(); track booking.id) {
        <div class="booking-card" [class.pending]="booking.status === 'pending'"
            [class.accepted]="booking.status === 'accepted'">

            <!-- Card Header -->
            <div class="card-header">
                <div class="customer-info">
                    <h3>{{ booking.customer_name }}</h3>
                    <p class="phone">üìû {{ booking.customer_phone }}</p>
                </div>
                <span class="status-pill" [ngClass]="'status-' + booking.status">
                    {{ booking.status | uppercase }}
                </span>
            </div>

            <!-- Route Information -->
            <div class="route-info">
                <div class="location pickup">
                    <span class="label">üìç PICKUP</span>
                    <p class="address">{{ booking.pickup_location }}</p>
                </div>
                <div class="route-arrow">‚Üí</div>
                <div class="location dropoff">
                    <span class="label">üéØ DROP-OFF</span>
                    <p class="address">{{ booking.drop_location }}</p>
                </div>
            </div>

            <!-- Shipment Details -->
            <div class="shipment-details">
                <div class="detail-item">
                    <span class="label">üì¶ GOODS</span>
                    <span class="value">{{ booking.goods_type }}</span>
                </div>
                <div class="detail-item">
                    <span class="label">‚öñÔ∏è WEIGHT</span>
                    <span class="value">{{ booking.weight }}</span>
                </div>
                <div class="detail-item price-item">
                    <span class="label">üí∞ OFFERED PRICE</span>
                    <span class="value price">‚Çπ{{ booking.offered_price }}</span>
                </div>
            </div>

            <!-- Actions for Pending Bookings -->
            @if (booking.status === 'pending') {
            <div class="card-actions">
                <button class="btn btn-accept" (click)="acceptBooking(booking)">
                    <span class="icon">‚úì</span>
                    ACCEPT
                </button>
                <button class="btn btn-counter" (click)="sendCounterOffer(booking)">
                    <span class="icon">üí¨</span>
                    COUNTER-OFFER
                </button>
                <button class="btn btn-reject" (click)="rejectBooking(booking)">
                    <span class="icon">‚úó</span>
                    REJECT
                </button>
            </div>
            }

            <!-- Bargaining Status -->
            @if (booking.status === 'bargaining' && booking.counter_offer) {
            <div class="negotiation-status">
                <div class="status-icon">üí¨</div>
                <div class="status-content">
                    <p class="status-title">Counter-offer sent: ‚Çπ{{ booking.counter_offer }}</p>
                    <p class="status-subtitle">Waiting for customer response...</p>
                </div>
            </div>
            }

            <!-- Accepted Status -->
            @if (booking.status === 'accepted') {
            <div class="accepted-status">
                <div class="status-icon">‚úì</div>
                <div class="status-content">
                    <p class="status-title">Booking Confirmed!</p>
                    <p class="status-subtitle">{{ booking.driver_response }}</p>
                </div>
            </div>
            }

            <!-- Rejected Status -->
            @if (booking.status === 'rejected') {
            <div class="rejected-status">
                <div class="status-icon">‚úó</div>
                <div class="status-content">
                    <p class="status-title">Booking Declined</p>
                    <p class="status-subtitle">{{ booking.driver_response }}</p>
                </div>
            </div>
            }

            <!-- Timestamp -->
            <div class="card-footer">
                <span class="timestamp">{{ booking.created_at | date:'short' }}</span>
            </div>
        </div>
        }
    </div>
    }
</section>

<!-- 
  STYLING (Add to your component's CSS or global styles)
  You can customize colors and spacing to match your app's design
-->

<style>
    .realtime-status {
        margin-bottom: 2rem;
    }

    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 9999px;
        font-weight: 600;
        font-size: 0.875rem;
    }

    .status-badge.connected {
        background: #dcfce7;
        color: #166534;
    }

    .status-badge.disconnected {
        background: #fee2e2;
        color: #991b1b;
    }

    .pulse-dot {
        width: 8px;
        height: 8px;
        background: #22c55e;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {

        0%,
        100% {
            opacity: 1;
        }

        50% {
            opacity: 0.5;
        }
    }

    .booking-count {
        background: rgba(0, 0, 0, 0.1);
        padding: 0.125rem 0.5rem;
        border-radius: 9999px;
        font-size: 0.75rem;
    }

    .booking-requests-section {
        padding: 2rem;
    }

    .section-header {
        margin-bottom: 2rem;
    }

    .section-header h2 {
        font-size: 1.875rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
    }

    .subtitle {
        color: #64748b;
        font-size: 0.875rem;
    }

    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        background: #f8fafc;
        border-radius: 1rem;
    }

    .empty-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
    }

    .empty-state h3 {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .empty-state p {
        color: #64748b;
        margin-bottom: 0.5rem;
    }

    .hint {
        font-size: 0.875rem;
        color: #94a3b8;
    }

    .bookings-grid {
        display: grid;
        gap: 1.5rem;
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
    }

    .booking-card {
        background: white;
        border: 2px solid #e2e8f0;
        border-radius: 1rem;
        padding: 1.5rem;
        transition: all 0.3s;
    }

    .booking-card.pending {
        border-color: #3b82f6;
        box-shadow: 0 4px 6px rgba(59, 130, 246, 0.1);
    }

    .booking-card.accepted {
        border-color: #22c55e;
        background: #f0fdf4;
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 1rem;
    }

    .customer-info h3 {
        font-size: 1.25rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
    }

    .phone {
        font-size: 0.875rem;
        color: #64748b;
    }

    .status-pill {
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 700;
    }

    .status-pending {
        background: #dbeafe;
        color: #1e40af;
    }

    .status-accepted {
        background: #dcfce7;
        color: #166534;
    }

    .status-rejected {
        background: #fee2e2;
        color: #991b1b;
    }

    .status-bargaining {
        background: #fef3c7;
        color: #92400e;
    }

    .route-info {
        display: grid;
        grid-template-columns: 1fr auto 1fr;
        gap: 1rem;
        margin-bottom: 1rem;
        padding: 1rem;
        background: #f8fafc;
        border-radius: 0.5rem;
    }

    .location .label {
        display: block;
        font-size: 0.75rem;
        font-weight: 700;
        color: #64748b;
        margin-bottom: 0.25rem;
    }

    .location .address {
        font-size: 0.875rem;
        font-weight: 600;
    }

    .route-arrow {
        display: flex;
        align-items: center;
        font-size: 1.5rem;
        color: #94a3b8;
    }

    .shipment-details {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1rem;
        margin-bottom: 1rem;
    }

    .detail-item {
        display: flex;
        flex-direction: column;
    }

    .detail-item .label {
        font-size: 0.75rem;
        font-weight: 700;
        color: #64748b;
        margin-bottom: 0.25rem;
    }

    .detail-item .value {
        font-size: 0.875rem;
        font-weight: 600;
    }

    .price-item .value {
        font-size: 1.25rem;
        color: #f97316;
        font-weight: 800;
    }

    .card-actions {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 0.5rem;
        margin-top: 1rem;
    }

    .btn {
        padding: 0.75rem 1rem;
        border: none;
        border-radius: 0.5rem;
        font-weight: 700;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }

    .btn-accept {
        background: #22c55e;
        color: white;
    }

    .btn-accept:hover {
        background: #16a34a;
        transform: scale(1.05);
    }

    .btn-counter {
        background: #f59e0b;
        color: white;
    }

    .btn-counter:hover {
        background: #d97706;
        transform: scale(1.05);
    }

    .btn-reject {
        background: #ef4444;
        color: white;
    }

    .btn-reject:hover {
        background: #dc2626;
        transform: scale(1.05);
    }

    .negotiation-status,
    .accepted-status,
    .rejected-status {
        display: flex;
        gap: 1rem;
        padding: 1rem;
        border-radius: 0.5rem;
        margin-top: 1rem;
    }

    .negotiation-status {
        background: #fef3c7;
        border: 1px solid #fbbf24;
    }

    .accepted-status {
        background: #dcfce7;
        border: 1px solid #22c55e;
    }

    .rejected-status {
        background: #fee2e2;
        border: 1px solid #ef4444;
    }

    .status-icon {
        font-size: 1.5rem;
    }

    .status-title {
        font-weight: 700;
        margin-bottom: 0.25rem;
    }

    .status-subtitle {
        font-size: 0.875rem;
        color: #64748b;
    }

    .card-footer {
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid #e2e8f0;
        text-align: right;
    }

    .timestamp {
        font-size: 0.75rem;
        color: #94a3b8;
    }
</style>